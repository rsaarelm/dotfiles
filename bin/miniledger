#!/usr/bin/python3

# Extremely simple ledger parser
# Reads a text file with a line syntax that can have:
#
#     Regular lines are comments
#
# And two types of data lines:
#
#     Add integer amount of `FOO` that comes from nowhere
#     > FOO 123
#     Buy 15 FOO with 30 BAR
#     > FOO 15  BAR 30
#
# After the ledger is run, balances of all items will be printed.

from collections import defaultdict
import sys

def fmt(name, credit, debit):
    if debit:
        return "%s: %s (%s)" % (name, credit + debit, credit)
    else:
        return "%s: %s" % (name, credit + debit)

class Ledger:
    def __init__(self, text):
        self.events = []

        for line in text.splitlines():
            line = line.strip()
            # Ledger lines must start with '> '
            if not line.startswith('> '):
                continue
            elts = line[2:].split()
            if len(elts) == 0:
                continue
            elif len(elts) in (2, 3, 4):
                self.events.append((elts[0], int(elts[1]), line))
                if len(elts) == 3:
                    self.events.append((elts[2], -int(elts[1]), line))
                elif len(elts) == 4:
                    self.events.append((elts[2], -int(elts[3]), line))
            else:
                assert False, "Syntax error: %s" % line

    def __str__(self):
        credits = defaultdict(int)
        debits = defaultdict(int)
        for (account, change, line) in self.events:
            if change > 0:
                credits[account] += change
            else:
                debits[account] += change
            # Print warning if account goes to negative
            balance = credits[account] + debits[account]
            if balance < 0:
                print("*** WARNING *** %s goes to %s at '%s'" %
                        (account, balance, line), file=sys.stderr)
        # XXX: Accounts with only debit actions will not be shown.
        return('\n'.join([fmt(account, credits[account], debits[account]) for account in credits]))

if __name__ == '__main__':
    print(Ledger(sys.stdin.read()))
