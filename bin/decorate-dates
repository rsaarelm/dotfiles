#!/usr/bin/env python3

# Find YYYY-MM-DD date strings in stdin and pipe them to stdout with week
# numbers and days of the week added.

import sys
import re
from datetime import datetime
from dataclasses import dataclass

@dataclass
class Entry:
    date: str
    week_number: int
    day_of_week: str
    message: str

def parse(line):
    date_pattern = r'\d{4}-\d{2}-\d{2}'
    match = re.search(date_pattern, line)
    if match:
        date = match.group()
        date_obj = datetime.strptime(date, '%Y-%m-%d')
        week_number = date_obj.isocalendar()[1]
        day_of_week = date_obj.strftime('%a')
        #decorated_date = f"{date_str} w{week_number:02} {day_of_week} "
        #return line.replace(date_str, decorated_date)
        return Entry(
            date,
            date_obj.isocalendar()[1],
            date_obj.strftime('%a'),
            line.replace(date, "", 1).strip()
        )
    return Entry("", 0, "", line.strip())

week_number = None
for line in sys.stdin:
    entry = parse(line.strip())
    if entry.date:
        if week_number is not None and week_number != entry.week_number:
            print()
        week_number = entry.week_number
        print(f"{entry.date} w{entry.week_number:02} {entry.day_of_week} {entry.message}")
    else:
        print(entry.message)
